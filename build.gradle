plugins {
  id 'jvm-component'
  id 'java-lang'
  id 'cpp'
  id 'visual-studio'
  id 'eclipse'
}

model {
  repositories {
    libs(PrebuiltLibraries) {
      jni.headers.srcDirs "${System.env.JAVA_HOME}/include", "${System.env.JAVA_HOME}/include/win32"
      dokan {
        headers.srcDir System.env.DOKAN_HOME
	binaries.withType(SharedLibraryBinary) {
          sharedLibraryLinkFile = file("${System.env.DOKAN_HOME}/dokan.lib")
	}
      }
    }
  }
  components {     
    'native'(NativeLibrarySpec) {
      baseName 'jdokan'
      binaries.all {
        cppCompiler.define "UNICODE"
      }
      sources.cpp {
        lib library: 'jni', linkage: 'api'
        lib library: 'dokan', linkage: 'shared'
	source {
          srcDir "src/main/cpp"
	  include "**/*.cpp"
	}
        exportedHeaders {
          srcDir "src/main/cpp/include"
        }
      }
    }
    java(JvmLibrarySpec) {
      baseName 'jdokan'
      sources.java.source.srcDirs "src/main/java", "src/test/java"
    }
  }

}