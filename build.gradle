plugins {
  id 'java'
  id 'cpp'
  id 'visual-studio'
  id 'eclipse'
}

model {
  repositories {
    libs(PrebuiltLibraries) {
      jni.headers.srcDirs "${System.env.JAVA_HOME}/include", "${System.env.JAVA_HOME}/include/win32"
      dokan {
        headers.srcDir System.env.DOKAN_HOME
	binaries.withType(SharedLibraryBinary) {
          sharedLibraryLinkFile = file("${System.env.DOKAN_HOME}/dokan.lib")
	}
      }
    }
  }
  components {     
    'native'(NativeLibrarySpec) {
      baseName 'jdokan'
      binaries.all {
        cppCompiler.define "UNICODE"
      }
      sources.cpp {
        lib library: 'jni', linkage: 'api'
        lib library: 'dokan', linkage: 'shared'
	source {
          srcDir "src/main/cpp"
	  include "**/*.cpp"
	}
        exportedHeaders {
          srcDir "src/main/cpp/include"
        }
      }
    }
  }
}

tasks.matching{ it.name.contains('StaticLibrary') }
  .whenTaskAdded { it.enabled = false }
tasks.matching{ it.name.contains('LibVisualStudio') }
  .whenTaskAdded { it.enabled = false }


repositories {
  jcenter()
}

dependencies {
  compile 'org.slf4j:slf4j-api:1.7.10'  
  compile 'rhino:js:1.7R1'
  testCompile 'junit:junit:4.+'
  testCompile 'org.slf4j:slf4j-log4j12:1.6.4'
}

eclipse {
  project.natures 'org.springsource.ide.eclipse.gradle.core.nature'
}
